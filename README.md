# Fantasy Football Analytics

Modern fantasy football analytics site built with Astro and Python data generators.

## âœ¨ Features

- **Player Statistics**: Comprehensive stats for all NFL players including QBs, RBs, WRs, TEs, Kickers, and DST
- **Defense Analytics**: Track points allowed by position with weekly breakdowns
- **Dynasty League**: Season standings, efficiency metrics, optimal lineup analysis, and advanced analytics
- **Chopped League**: Elimination-style league with safety margins, close calls, and survival analysis
- **Interactive Charts**: Chart.js visualizations for weekly performance and trends
- **Mobile Responsive**: Optimized for all screen sizes
- **Static Site**: Fast, SEO-friendly pages generated by Astro

## ğŸ“ Project Structure

```
FantasyTool/
â”œâ”€â”€ scripts/                          # Python data generators
â”‚   â”œâ”€â”€ core_data.py                 # Shared utilities and API clients
â”‚   â”œâ”€â”€ generate_data.py             # Main entry point (runs all generators)
â”‚   â”œâ”€â”€ generate_player_stats.py    # Generate player_stats.json
â”‚   â”œâ”€â”€ generate_defense_stats.py   # Generate defense_stats.json
â”‚   â”œâ”€â”€ generate_dst_stats.py       # Generate dst_stats.json
â”‚   â”œâ”€â”€ generate_kicker_stats.py    # Generate kicker_stats.json
â”‚   â”œâ”€â”€ generate_season_stats.py    # Generate season stats for both leagues
â”‚   â””â”€â”€ generate_scoring_config.py  # Generate scoring configuration
â”‚
â”œâ”€â”€ output/                           # Generated JSON files (intermediate)
â”‚   â”œâ”€â”€ defense_stats.json
â”‚   â”œâ”€â”€ player_stats.json
â”‚   â”œâ”€â”€ season_stats_dynasty.json
â”‚   â”œâ”€â”€ season_stats_chopped.json
â”‚   â””â”€â”€ league_data/                 # Raw Sleeper API data cache
â”‚
â”œâ”€â”€ website/                          # Astro static site
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/                   # Routes (auto-generated from structure)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.astro         # Home page
â”‚   â”‚   â”‚   â”œâ”€â”€ player-stats.astro  # All players table
â”‚   â”‚   â”‚   â”œâ”€â”€ defense-stats.astro # Defense rankings
â”‚   â”‚   â”‚   â”œâ”€â”€ season-stats-dynasty.astro
â”‚   â”‚   â”‚   â”œâ”€â”€ season-stats-chopped.astro
â”‚   â”‚   â”‚   â”œâ”€â”€ players/[player_id].astro  # Dynamic player pages
â”‚   â”‚   â”‚   â””â”€â”€ defense/[team].astro       # Dynamic defense pages
â”‚   â”‚   â””â”€â”€ layouts/                # Shared layouts
â”‚   â”‚       â””â”€â”€ BaseLayout.astro
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ data/                   # JSON consumed by Astro (copied from output/)
â”‚   â””â”€â”€ dist/                       # Built site (generated by npm run build)
â”‚
â”œâ”€â”€ update.sh                        # Quick update script
â”œâ”€â”€ requirements.txt                 # Python dependencies
â””â”€â”€ README.md
```

## ğŸš€ Quick Start

### 1. Setup Python Environment

```bash
# Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

### 2. Setup Node Environment

```bash
cd website
npm install
cd ..
```

### 3. Generate Data & Run Site

**Option A: Generate data and start dev server**
```bash
./update.sh --dev
```

**Option B: Generate data and build for production**
```bash
./update.sh --build
```

**Option C: Just generate data**
```bash
python scripts/generate_data.py
```

## ğŸ“Š Data Generators

### All Stats (Recommended)
```bash
python scripts/generate_data.py
```

### Individual Generators
```bash
python scripts/generate_data.py --players   # Player stats only
python scripts/generate_data.py --defense   # Defense stats only
python scripts/generate_data.py --dst       # DST stats only
python scripts/generate_data.py --kickers   # Kicker stats only
python scripts/generate_data.py --season    # Season stats only
```

### What Each Generator Does

| Generator | Output File(s) | Data Source | Purpose |
|-----------|---------------|-------------|---------|
| `generate_player_stats.py` | `player_stats.json` | nflverse | Regular position player stats (QB/RB/WR/TE) |
| `generate_defense_stats.py` | `defense_stats.json` | nflverse | Points allowed by opposing defense |
| `generate_dst_stats.py` | `dst_stats.json` | nflverse | Defense/Special Teams scoring stats |
| `generate_kicker_stats.py` | `kicker_stats.json` | nflverse | Kicker performance stats |
| `generate_season_stats.py` | `season_stats_dynasty.json`<br>`season_stats_chopped.json` | Sleeper API | League standings & analytics |

## ğŸ“ Configuration

### League Settings

Edit `scripts/generate_season_stats.py` to modify league IDs:

```python
LEAGUES = {
    'dynasty': {
        'id': '1264304480178950144',
        'name': 'Dynasty League'
    },
    'chopped': {
        'id': '1263579037352079360', 
        'name': 'Chopped League'
    }
}
```

### Scoring Settings

Scoring presets are defined in `scripts/core_data.py`. The site uses half-PPR scoring by default.

## ğŸ—ï¸ Architecture

### Data Flow

```
1. Python Scripts (scripts/)
   â”œâ”€ Fetch data from nflverse & Sleeper API
   â”œâ”€ Process and calculate statistics
   â””â”€ Generate JSON files â†’ output/

2. Copy to Website (automatic via scripts)
   â””â”€ output/*.json â†’ website/public/data/*.json

3. Astro Build (website/)
   â”œâ”€ Import JSON data at build time
   â”œâ”€ Generate static HTML pages
   â””â”€ Output to website/dist/

4. Deploy
   â””â”€ Upload dist/ to Cloudflare Pages or any static host
```

### Key Technologies

- **Python**: Data processing and API integration
  - `nflreadpy`: NFL statistics from nflverse
  - `requests`: Sleeper API integration
  - `pandas`: Data manipulation
  
- **Astro**: Static site generation
  - Server-side rendering at build time
  - Zero JavaScript by default (opt-in for interactivity)
  - Automatic routing from file structure
  
- **Chart.js**: Interactive data visualizations

### Core Modules

**`core_data.py`** - Shared utilities:
- `SleeperAPI` - Sleeper API client with caching
- `calculate_fantasy_points()` - Unified scoring calculation
- `SCORING_PRESETS` - Half-PPR, full-PPR, standard scoring
- Directory management and JSON helpers

## ğŸŒ Deployment

### Build for Production

```bash
# Generate data and build site
./update.sh --build

# Output will be in website/dist/
```

### Deploy to Cloudflare Pages with Automated Updates

The project includes GitHub Actions for automated deployment and nightly data updates.

**Quick Setup:**

1. **Get Cloudflare credentials**:
   - API Token: Cloudflare Dashboard â†’ Profile â†’ API Tokens
   - Account ID: Cloudflare Dashboard â†’ Workers & Pages (right sidebar)

2. **Add GitHub secrets**:
   - Repository â†’ Settings â†’ Secrets â†’ Actions
   - Add `CLOUDFLARE_API_TOKEN` and `CLOUDFLARE_ACCOUNT_ID`

3. **Create Cloudflare Pages project**:
   - Name: `fantasy-tool`
   - Connect GitHub repository
   - Framework preset: Astro

4. **Push to deploy**:
   ```bash
   git push origin main
   ```

The workflow automatically:
- Runs Python data generators nightly at 3 AM EST
- Builds Astro site
- Deploys to Cloudflare Pages

**Full guide**: [CLOUDFLARE_DEPLOY.md](./CLOUDFLARE_DEPLOY.md)

**Manual deployment**:
```bash
cd website && npm run build
# Upload dist/ to Cloudflare Pages dashboard
```

## ğŸ”§ Development

### Run Dev Server

```bash
./update.sh --dev
# Site will be available at http://localhost:4321
```

### Update Data Without Restarting

In a separate terminal:
```bash
source venv/bin/activate
python scripts/generate_data.py
# Astro will hot-reload automatically
```

### Add New Pages

Create `.astro` files in `website/src/pages/`:
- `about.astro` â†’ `/about`
- `stats/weekly.astro` â†’ `/stats/weekly`
- `players/[id].astro` â†’ `/players/:id` (dynamic route)

## ğŸ“¦ Dependencies

### Python Requirements
```
nflreadpy>=0.1.0    # NFL data from nflverse
pandas>=2.0.0       # Data manipulation
requests>=2.31.0    # HTTP requests for Sleeper API
certifi>=2023.0.0   # SSL certificates
```

### Node Requirements
```
astro>=4.0.0        # Static site framework
chart.js>=4.0.0     # Data visualizations
```

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## ğŸ“„ License

MIT License - See LICENSE file for details

## ğŸ™ Acknowledgments

- **nflverse** - NFL data and statistics
- **Sleeper** - Fantasy league API
- **Astro** - Static site framework
- **Chart.js** - Data visualization

## ğŸ“ Support

For issues or questions, please open an issue on GitHub.
- `make_request()` - HTTP request handler
- `calculate_fantasy_points()` - PPR scoring calculator
- `save_json()` - JSON file writer

### Benefits
- âœ… No HTML generation - Pure data generators
- âœ… Modular - Each stat type is independent
- âœ… Reusable - Shared utilities in core_data.py
- âœ… Maintainable - Clear separation of concerns
- âœ… Fast - Only regenerate what's needed

## ğŸŒ Deployment

### Build for Production
```bash
./update.sh --build
```

### Deploy to Cloudflare Pages
```bash
cd website
npm run build
# Upload dist/ folder to Cloudflare Pages
```

## ğŸ› ï¸ Development

```bash
# Terminal 1: Dev server with hot reload
cd website && npm run dev

# Terminal 2: Regenerate data as needed
python generate_data.py --defense
```

## ğŸ“¦ Dependencies

### Python
- `nflreadpy` - NFL player statistics
- `requests` - HTTP client
- `pandas` - Data processing
- `certifi` - SSL certificates

### Node
- `astro` - Static site generator
- `chart.js` - Visualization library
- Receptions: 1 point (PPR)
- 2-point conversions: 2 points
- Interceptions: -1 point
- Fumbles lost: -2 points

## Data Sources

- **Sleeper API**: League data, rosters, matchups
- **nflverse/nflreadpy**: NFL player stats, snap counts, roster data

## Requirements

- Python 3.8+
- requests
- certifi
- nflreadpy
- pandas
- numpy

## License

MIT License

## Acknowledgments

- [Sleeper API](https://docs.sleeper.com/) for fantasy league data
- [nflverse](https://github.com/nflverse) for NFL statistics
- [nflreadpy](https://github.com/nflverse/nflreadpy) for Python data access

## Contributing

Feel free to open issues or submit pull requests for improvements!
